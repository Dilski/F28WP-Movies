<?php

class loginModel
{
    protected $dbConnection;

    function __construct(PDO $db)
    {
        $this->dbConnection = $db;
        $this->dbConnection->setAttribute(PDO::ATTR_EMULATE_PREPARES, false);
        $this->dbConnection->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);
    }

    function tryLogin($user, $pass)
    {
        try {
            if (!(isset($user) && isset($pass))) {
                echo "Please submit a username and a password";
            } else {
            	echo $user.$pass;
                $query = $this->dbConnection->prepare('Select `password` FROM `my_users` WHERE `username` = :id');
						                
                $query->execute(array(':id' => $user));
                $hashFetch = $query->fetch()[0];
           
                
                if (password_verify($pass, $hashFetch)){
                	session_start();
                	$_SESSION['username'] = $user;
                	} else {
                		echo "Password Incorrect"; 

							}
            }

        } catch (PDOException $e) {
            echo "Error: " . $e;
        }

    }


}
?>